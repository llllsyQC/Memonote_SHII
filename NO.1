Sub æ›´æ–°ã¨ç²¾åº¦å‘ä¸Šã—ãŸã‚¿ã‚¤ãƒˆãƒ«è­˜åˆ¥()
    Dim Wb1 As Workbook, Wb2 As Workbook
    Dim fileName As String, filePath As String
    Dim userDate As String
    Dim wsSource As Worksheet, wsTarget As Worksheet
    Dim lastRow As Long, i As Long
    Dim titleFound As Boolean
    Dim titleText As String
    Dim shiftType As String
    Dim timeValue As String
    Dim actualTime As Variant

    ' 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æ—¥å ±ã®æ—¥ä»˜ã‚’å…¥åŠ›ã•ã›ã‚‹
    userDate = InputBox("æ—¥å ±ã®æ—¥ä»˜ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: YYYYMMDD)", "æ—¥ä»˜å…¥åŠ›")

    ' 2. å…¥åŠ›ã®æ¤œè¨¼
    If userDate = "" Or Not IsNumeric(userDate) Or Len(userDate) <> 8 Then
        MsgBox "æœ‰åŠ¹ãªæ—¥ä»˜ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: YYYYMMDD)", vbExclamation, "ã‚¨ãƒ©ãƒ¼"
        Exit Sub
    End If

    ' 3. æ—¥å ±ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’ç”Ÿæˆ
    fileName = "å¤§å®®æ—¥å ±" & userDate & ".xlsx"
    filePath = "C:\Users\lis105\Desktop\06. æ—¥å ±\" & fileName

    ' 4. ãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ã‚’ç¢ºèª
    If Dir(filePath) = "" Then
        MsgBox "ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: " & fileName, vbCritical, "ã‚¨ãƒ©ãƒ¼"
        Exit Sub
    End If

    ' 5. å‡¦ç†ã®æœ€çµ‚ç¢ºèª
    If MsgBox(fileName & " ã‚’é–‹ã„ã¦å‡¦ç†ã‚’ç¶šè¡Œã—ã¾ã™ã‹ï¼Ÿ", vbYesNo + vbQuestion, "ç¢ºèª") = vbNo Then
        Exit Sub
    End If

    ' 6. åŒåã®é–‹ã„ã¦ã„ã‚‹æ—¥å ±ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‰ã˜ã‚‹
    On Error Resume Next
    Workbooks(fileName).Close False
    On Error GoTo 0

    ' 7. æ—¥å ±ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã
    Set Wb2 = Workbooks.Open(filePath)

    ' 8. "æ—¥å ±" ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ¼ãƒˆã‚’å–å¾—
    On Error Resume Next
    Set wsSource = Wb2.Worksheets("æ—¥å ±")
    On Error GoTo 0
    If wsSource Is Nothing Then
        MsgBox "å¯¾è±¡ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ¼ãƒˆ 'æ—¥å ±' ãŒ " & fileName & " ã«å­˜åœ¨ã—ã¾ã›ã‚“", vbCritical, "ã‚¨ãƒ©ãƒ¼"
        Wb2.Close False
        Exit Sub
    End If

    ' 9. "æ—¥å ±è»¢è¨˜" ã‚·ãƒ¼ãƒˆã‚’æº–å‚™
    Set Wb1 = ThisWorkbook
    On Error Resume Next
    Set wsTarget = Wb1.Worksheets("æ—¥å ±è»¢è¨˜")
    If wsTarget Is Nothing Then
        Set wsTarget = Wb1.Sheets.Add
        wsTarget.Name = "æ—¥å ±è»¢è¨˜"
    End If
    On Error GoTo 0

    ' ğŸ” è»¢è¨˜å…ˆã‚’ã‚¯ãƒªã‚¢
    wsTarget.Cells.Clear

    ' ğŸ” ãƒ•ã‚¡ã‚¤ãƒ«åã‚’A1ã«æ›¸ãè¾¼ã‚€ï¼ˆãƒ­ã‚°ç”¨ï¼‰
    wsTarget.Range("A1").Value = "å–å¾—å…ƒæ—¥å ±: " & fileName

    ' 10. ãƒ‡ãƒ¼ã‚¿ã®è²¼ã‚Šä»˜ã‘
    lastRow = wsSource.Cells(wsSource.Rows.Count, "B").End(xlUp).Row
    wsSource.Rows("35:" & lastRow).Copy
    wsTarget.Range("A2").PasteSpecial Paste:=xlPasteValues ' A2ã«è²¼ã‚Šä»˜ã‘ã¦ãƒ­ã‚°ã¨åˆ†é›¢

    ' 11. æ—¥å ±ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‰ã˜ã‚‹
    Wb2.Close False

    ' 12. ãƒ‡ãƒ¼ã‚¿ã®æœ€çµ‚è¡Œã‚’å†å–å¾—
    lastRow = wsTarget.Cells(wsTarget.Rows.Count, "B").End(xlUp).Row

    ' 13. Båˆ—ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆä¿®æ­£
    wsTarget.Columns("B").NumberFormat = "@"

    ' 14. ã‚¿ã‚¤ãƒˆãƒ«è¡Œåˆ¤å®šï¼‹ã‚·ãƒ•ãƒˆåˆ¤å®šï¼‹åˆ—ã‚³ãƒ”ãƒ¼
    For i = 1 To lastRow
        titleFound = False
        titleText = Trim(Replace(Replace(wsTarget.Cells(i, 4).Value, vbCr, ""), vbLf, ""))
        If titleText Like "ã€*ã€‘*" Then titleFound = True

        If titleFound Then
            timeValue = Trim(CStr(wsTarget.Cells(i + 1, 2).Value))
            actualTime = 0

            If timeValue <> "" And IsNumeric(Replace(timeValue, ":", "")) Then
                On Error Resume Next
                actualTime = CDate(timeValue)
                On Error GoTo 0
            End If

            If actualTime = 0 Then
                shiftType = "ä¸æ˜"
            ElseIf actualTime >= 0.375 And actualTime < 0.7083 Then
                shiftType = "æ—¥"
            Else
                shiftType = "å¤œ"
            End If

            wsTarget.Cells(i, 39).Value = shiftType
            wsTarget.Range(wsTarget.Cells(i, 4), wsTarget.Cells(i, 38)).Copy
            wsTarget.Cells(i, 40).PasteSpecial Paste:=xlPasteValues
        End If
    Next i

    ' 15. ä¸è¦ãªåˆ—å‰Šé™¤
    wsTarget.Range("AO:BG").Delete Shift:=xlToLeft

    ' ğŸ” reportDate ã«å…¥åŠ›å€¤ã‚’ä¿å­˜ï¼ˆå‘½åç¯„å›²ç”¨ï¼‰
    ThisWorkbook.Names.Add Name:="reportDate", RefersTo:="=""" & userDate & """"

    MsgBox "âœ… ã‚¿ã‚¤ãƒˆãƒ«ã®è­˜åˆ¥ã¨ãƒ‡ãƒ¼ã‚¿è»¢è¨˜ãŒå®Œäº†ã—ã¾ã—ãŸï¼", vbInformation

End Sub
