Sub 工数番号貼付_背景色判定_最終統合版()

    Dim wsSrc As Worksheet, wsDest As Worksheet
    Dim 工数Map As Object
    Dim srcRow As Long, destRow As Long, i As Long
    Dim 工数番号 As String
    Dim matchCount As Long
    Dim dayColStart As Long, pasteCol As Long

    Set wsSrc = ThisWorkbook.Worksheets("0消し(最終)")
    Set wsDest = ThisWorkbook.Worksheets("工数取得-都度対応項目(時間)")
    Set 工数Map = CreateObject("Scripting.Dictionary")

    ' Step 1：建立 工数番号 → 対応行号 的映射（I11:I64）
    For destRow = 11 To 64
        工数番号 = Trim(CStr(wsDest.Cells(destRow, "I").Value))
        If 工数番号 <> "" Then
            工数Map(工数番号) = destRow
        End If
    Next

    ' Step 2：针对每天，判断颜色并贴对应列（共31天）
    For i = 0 To 30
        dayColStart = 2 * i + 6 ' 在 0消し → 每天2列，起点 F=6
        If ws1.Cells(11, 4 * i + 15).DisplayFormat.Interior.ColorIndex = xlNone Then
            pasteCol = 4 * i + 17 ' 休日 → 右側列
        Else
            pasteCol = 4 * i + 15 ' 平日 → 左側列
        End If

        ' 逐个工数番号对应行复制贴入
        For srcRow = 6 To 52
            工数番号 = Trim(CStr(wsSrc.Cells(srcRow, "E").Value))
            If 工数Map.exists(工数番号) Then
                destRow = 工数Map(工数番号)
                wsDest.Cells(destRow, pasteCol).NumberFormat = "h:mm"
                wsDest.Cells(destRow, pasteCol).Value = wsSrc.Cells(srcRow, dayColStart).Value

                wsDest.Cells(destRow, pasteCol + 1).NumberFormat = "h:mm"
                wsDest.Cells(destRow, pasteCol + 1).Value = wsSrc.Cells(srcRow, dayColStart + 1).Value

                matchCount = matchCount + 1
            End If
        Next srcRow
    Next i

    MsgBox "工数番号＋背景色貼付完了：" & matchCount & " 件", vbInformation

End Sub